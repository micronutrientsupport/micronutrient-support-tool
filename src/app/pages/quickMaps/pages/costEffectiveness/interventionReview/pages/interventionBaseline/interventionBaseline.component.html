<div class="container">
  <div class="content">
    <app-intervention-description></app-intervention-description>
    <div class="title">
      <span>Baseline Assumptions</span>
    </div>

    <table mat-table [dataSource]="dataSource" class="table-full-width">
      <ng-container matColumnDef="title">
        <td class="row-title-left" mat-cell *matCellDef="let element">
          {{ element.title }}
        </td>
      </ng-container>

      <ng-container matColumnDef="baseline_value">
        <td mat-cell *matCellDef="let element">
          <div class="double-cell">
            <input type="text" appDecimalInput required [ngModel]="element.year0.toFixed(2)">
            <button mat-button color="primary">
              GFDx<mat-icon>arrow_right_alt</mat-icon>
            </button>
          </div>
        </td>
      </ng-container>

      <span>
        <button mat-button>
          GFDx<mat-icon>arrow_right_alt</mat-icon>
        </button>
      </span>

      <tr mat-row *matRowDef="let row; columns: baselinedisplayedColumns;"></tr>
    </table>

    <div class="header-row">
      <div class="title standard">
        <span>Food vehicle standard/target fortification levels</span>
      </div>

      <div class="title compliance">
        <span>Baseline compliance/fortification in practice</span>
      </div>
    </div>

    <div class="focus-mn">
      <div class="divider"></div>
      <span class="sub-header">Focus micronutrient</span>
    </div>

    <div class="lower-table-wrapper">
      <table mat-table [dataSource]="FVdataSource" class="table-full-width">
        <ng-container matColumnDef="micronutrient">
          <th class="row-title focus" mat-header-cell *matHeaderCellDef>
            Micronutrient
          </th>
          <td mat-cell *matCellDef="let element">
            {{ (quickMapsService.micronutrient.obs | async)?.name }}
          </td>
        </ng-container>
        <ng-container matColumnDef="compound">
          <th class="row-title" mat-header-cell *matHeaderCellDef>
            Compound
          </th>
          <td mat-cell *matCellDef="let element">
            <mat-form-field appearance="outline" class="override">
              <mat-select [(ngModel)]="selectedCompound" matNativeControl>
                <mat-option *ngFor="let item of element.compounds" [value]="item">
                  {{ item.compound }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </td>
        </ng-container>
        <ng-container matColumnDef="targetVal">
          <th class="row-title" mat-header-cell *matHeaderCellDef>Standard/target nutrient level at point of
            fortification (mg/kg)
          </th>
          <td mat-cell *matCellDef="let element">
            <div class="double-cell">
              <input type="text" appDecimalInput required [ngModel]="selectedCompound.targetVal">
              <span>
                <button mat-button color="primary">
                  GFDx <mat-icon>arrow_right_alt</mat-icon>
                </button>
              </span>
            </div>
          </td>
        </ng-container>
        <ng-container matColumnDef="avgVal">
          <th class="row-title" mat-header-cell *matHeaderCellDef>Calculated average fortification level (mg/kg) among
            fortifiable food vehicle at point of fortification
            <button class="icon-display" mat-mini-fab color="primary" (click)="openFortificationInfoDialog()">
              <mat-icon class="icon-display">question_mark</mat-icon>
            </button>
          </th>
          <td mat-cell *matCellDef="let element">
            <div class="double-cell">
              <span>
                {{ selectedCompound.targetVal * baselineAssumptions?.potentiallyFortified.year0 }}
              </span>
              <span>
                <button mat-button color="primary">
                  GFDx<mat-icon>arrow_right_alt</mat-icon>
                </button>
              </span>
            </div>
          </td>
        </ng-container>

        <ng-container matColumnDef="optFort">
          <th class="row-title" mat-header-cell *matHeaderCellDef>Optional user-entered average fortification level
            (mg/kg) among fortifiable food vehicle at point of fortification
          </th>
          <td mat-cell *matCellDef="let element">
            <div class="double-cell">
              <input type="text" appDecimalInput required
                [(ngModel)]="optionalUserEnteredAverageAtPointOfFortification">
              <span>
                <button mat-button color="primary">
                  GFDx <mat-icon>arrow_right_alt</mat-icon>
                </button>
              </span>
            </div>
          </td>
        </ng-container>

        <ng-container matColumnDef="calcFort">
          <th class="row-title" mat-header-cell *matHeaderCellDef>
            Calculated average fortification level (mg/kg) among
            all food vehicle
            <button class="icon-display" mat-mini-fab color="primary" (click)="openCalculatedFortificationInfoDialog()">
              <mat-icon class="icon-display">question_mark</mat-icon>
            </button>
          </th>
          <td mat-cell *matCellDef="let element">
            <div class="double-cell">
              <span *ngIf="null != baselineAssumptions">
                {{ optionalUserEnteredAverageAtPointOfFortification * baselineAssumptions.actuallyFortified.year0 *
                baselineAssumptions.potentiallyFortified.year0 | sigFig:3 }}
              </span>
            </div>
          </td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="baselineFVdisplayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: baselineFVdisplayedColumns;"></tr>
      </table>
    </div>

    <app-intervention-step-details [resetDefaultValues]="true" [showFocusMn]="true" [showUserValues]="true"
      [showMnUnits]="true" (onAddMn)="handleAddMn($event)">
    </app-intervention-step-details>

    <app-micro-nutrients-in-premix-table [editable]="true"
      [micronutrient]="newMnInPremix"></app-micro-nutrients-in-premix-table>
  </div>
  <footer>
    <a class="intervention-navigation" mat-stroked-button [routerLink]="ROUTES.QUICK_MAPS_COST_EFFECTIVENESS | route"
      queryParamsHandling="preserve">Save and close</a>
    <a class="intervention-navigation-confirm" mat-stroked-button
      [routerLink]="ROUTES.INTERVENTION_REVIEW_COMPLIANCE | route" queryParamsHandling="preserve">Confirm and
      continue</a>
  </footer>
</div>
