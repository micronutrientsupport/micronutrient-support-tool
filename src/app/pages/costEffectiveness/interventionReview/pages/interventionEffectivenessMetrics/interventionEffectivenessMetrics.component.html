<div class="bmgf-maps-nice-scrollbar container">
  <div class="content">
    <app-intervention-description></app-intervention-description>
    <div class="title">
      <span>Nutrient requirements</span>
    </div>

    <app-reusable-skeleton-table *ngIf="!dataLoaded" [setData]="{ columns: 11, rows: 2 }"></app-reusable-skeleton-table>

    <form [formGroup]="form" *ngIf="dataLoaded" class="premixCalcForm">

      <p>
        <strong>Reference Household Member</strong>: Non-pregnant, Non-lactating Adult Female
      </p>

      <table *ngFor="let row of data; index as index" mat-table
        [dataSource]="dataSource.filteredData | slice:index:(index+1)" class="table-full-width">
        <ng-container matColumnDef="threshold">
          <th class="row-title-left" mat-header-cell *matHeaderCellDef>
            {{ row.title }} </th>
          <td class="row-title-left row-left" [ngClass]="{'non-editable': !element.field}" mat-cell
            *matCellDef="let element">
            <span *ngIf="!element.field">{{ element.threshold | number: '1.0-0' }}</span>
            <app-ce-input-field *ngIf="element.field" [index]="0" [field]="element.field" [fieldType]="'number'"
              [element]="data[index]" [form]="form" [tableData]="dataSource" [dirtyIndexes]="[]"
              [includeCopyRightButton]="false" [changeFunction]="updateField(index, element.field)"
              [omitStyling]="false"></app-ce-input-field>
          </td>
        </ng-container>

        <ng-container matColumnDef="units">
          <th mat-header-cell *matHeaderCellDef>Units</th>
          <td mat-cell *matCellDef="let element; let index = index">
            {{element.units}}
          </td>
        </ng-container>

        <ng-container matColumnDef="source">
          <th mat-header-cell *matHeaderCellDef>Source</th>
          <td mat-cell *matCellDef="let element; let index = index">
            <span *ngIf="element.thresholdDefault && element.threshold !== element.thresholdDefault">User defined</span>
            <span *ngIf="!element.thresholdDefault || element.threshold === element.thresholdDefault">{{element.source}}
              {{ element.threshold}} {{ element.thresholdDefault}}</span>
          </td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>
    </form>
    <app-intervention-step-details (resetValues)="resetForm()" [resetDefaultValues]="true" [showFocusMn]="false"
      [showUserValues]="true" [showUserOverrideValues]="false" [showNonEditable]="true" [showMnUnits]="false"
      [showAddMicronutrient]="false"></app-intervention-step-details>
  </div>
  <footer>
    <a class="intervention-navigation" mat-stroked-button [routerLink]="intSideNavService.getPreviousRoute() | route"
      queryParamsHandling="preserve">Back</a>
    <a class="intervention-navigation" mat-stroked-button [routerLink]="ROUTES.COST_EFFECTIVENESS | route"
      queryParamsHandling="preserve">Save and close</a>
    <button *ngFor="let route of intSideNavService.getNextRoutes()" [disabled]="loading" class="intervention-navigation"
      mat-flat-button color="primary" (click)="confirmAndContinue(route.route)">
      <span *ngIf="!loading">{{ route.title }}</span>
      <span *ngIf="loading">Recalculating model values&nbsp;<mat-spinner class="loading-indicator" aria-label="spinner"
          [diameter]="16" color='accent'></mat-spinner></span>
    </button>
  </footer>
</div>